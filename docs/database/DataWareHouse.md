# DataWareHouse 数据仓库
## 特点
- 面向主题的：数据仓库的数据组织方式与 OLTP 面向事务处理不同，因为数据仓库是面向分析决策的，所以数据经常按分析场景或者是分析对象等主题形式来组织；
- 集成的：对于数据仓库来说，经常需要去集合多个分散的、异构的数据源，做一些数据清洗等 ETL 处理，整合成一块数据仓库，OLTP 则不需要做类似的集成操作；
- 相对稳定的：OLTP 数据库一般都是面向业务的，它主要的作用是把当前的业务状态精准的反映出来，所以 OLTP 数据库需要支持大量的增、删、改的操作，但是对于数据仓库来说，只要是入仓存下来的数据，一般使用场景都是查询，因此数据是相对稳定的；
- 反映历史变化：数据仓库是反映历史变化的数据集合，可以理解成它会将历史的一些数据的快照存下来。而对于 OLTP 数据库来说，只要反映当时的最新的状态就可以了。

## 数据分层思想
- ODS：原始数据层，存放原始数据，直接加载原始日志、数据，数据保持原貌不做处理；
- DWD：明细数据层，结构和粒度与ODS层保持一致，对ODS层的数据进行清洗（去除空值、脏数据、超过极限范围的数据）；
- DWS：服务数据层，以DWD层的数据为基础，进行轻度汇总，一般聚集到以用户当日、设备当日、商家当日、商品当日等的粒度。在这层通常会以某一个维度为线索，组成跨主题的宽表，比如，由一个用户当日的签到数、收藏数、评价数、抽奖数、订阅数、点赞数、浏览商品数、添加购物车数、下单数、支付数、退款数及点击广告数组成的宽表；
- ADS：应用数据层，也有人把这层称为APP层、DAL层、DM层等，面向实际的数据需求，以DWD层、DWS层和DWT层的数据为基础，组成各种统计报表，统计结果最终同步到关系型数据库，如MySQL，以供BI或应用系统查询使用。

## 数据仓库架构
### Lambda 架构
- 离线数仓 + 实时数仓；
- 离线数仓进行批处理，将大量 T+1 的数据进行汇总，录入到服务数据库；
- 实时数仓进行流处理或微批处理，录入到服务数据库；
- 需要维护实时处理和离线处理两套代码，还要保证两套处理结果保持一致；
### Kappa 架构
- Kafka 对接实时处理系统，录入到服务数据库；
- 业务逻辑变更或者需要数据订正时，进行数据重放，同时新启动一个任务消费，当进度与旧任务一致时，停止旧任务，切换到新任务；
- 消息中间件只会保留一定时间范围内的数据，回溯之前太长时间的数据压力比较大，计算消耗也比较大；
- 多个流进行关联时存在数据先后顺序问题，可能导致数据丢失；