# MySQL
存储引擎原理， 索引原理，SQL 执行流程，事务隔离，常用 SQL，SQL 优化，数据库优化，读写分离，分库分表

## 架构
![](http://images.intflag.com/mysql000.png)

- 连接器：管理连接，权限验证；
    - wait_timeout：默认 8 小时；
    - mysql_reset_connection：MySQL 5.7+ 版本，在不需要重连和权限验证的情况下可以重新初始化资源；
- 查询缓存：SQL 命中缓存直接返回结果；
    - 表只要有一个更新，所以的查询缓存都会失效；
    - SQL_CACHE 或 SQL_NO_CACHE；
    - MySQL 8.0 后该模块被移除；
- 分析器
    - 词法分析：查询语句、更新语句、表名、列名；
    - 语法分析：语句错误；
- 优化器：索引选择、决定表连接的顺序等;
- 执行器：操作数据库引擎，返回结果。

## 存储引擎

### 1、MyISAM 与 InnoDB

|特性|InnoDB|MyISAM|
|:----:|:----:|:----:|
|事务|支持|不支持|
|主键|必须|非必须|
|外键|支持|不支持|

### 2、InnoDB 存储原理

![](http://images.intflag.com/mysql001.png)

- 数据页：数据被分成若干页，以页为单位保存在磁盘中，处理时加载到内存中，各个数据页组成一个双向链表，默认页大小 16 KB，每个数据页中的记录按照主键顺序组成单向链表；
- 页目录：方便按照主键查询记录；
- 槽：相当于分组，每个分组负责若干条记录；
- 记录：记录前面的数字代表当前分组的记录条数；
- 查询：利用二分法，先定位到槽，然后在分组内顺序搜索。

## 索引

### 1、B+Tree
- 叶子节点用来存放数据，聚集索引（主键索引）存放整行记录，非聚集索引（二级索引）存放主键值；
- 上层非叶子节点用来存放目录项，作为索引；
- 所有节点按照索引键大小排序，构成一个双向链表，加速范围查找。

- 主键索引
![](http://images.intflag.com/mysql002.png)

- 二级索引
![](http://images.intflag.com/mysql003.png)

## SQL 执行流程
## 事务隔离
## SQL 优化
## 数据库优化
## 高可用
## 分库分表
## 常用 SQL